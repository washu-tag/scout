---
- name: Install gpu-operator
  hosts: server
  gather_facts: false
  environment:
    KUBECONFIG: '{{ kubeconfig_yaml }}'

  tasks:
    - name: Deploy NVIDIA GPU Operator
      ansible.builtin.include_tasks: tasks/deploy_helm_chart.yaml
      vars:
        helm_chart_name: gpu-operator
        helm_chart_ref: gpu-operator/gpu-operator
        helm_chart_version: '~24.9.2'
        helm_chart_namespace: '{{ gpu_operator_namespace | default("gpu-operator") }}'
        helm_repo_name: gpu-operator
        helm_repo_url: https://nvidia.github.io/gpu-operator
        helm_chart_create_namespace: true
        helm_chart_wait: true
        helm_chart_timeout: 5m
        helm_chart_values_files:
          - vars/gpu-operator.values.yaml
