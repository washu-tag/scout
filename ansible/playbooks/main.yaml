---
- name: Clone Scout repository
  import_playbook: scout.yaml
  when: clone_scout_repo | default(true)

- name: Install K3s on staging node
  import_playbook: staging-k3s.yaml
  when:
    - groups.get('staging', []) | length > 0

- name: Deploy Harbor on staging node
  import_playbook: harbor.yaml
  when:
    - groups.get('staging', []) | length > 0
    - air_gapped | default(false) | bool

- name: Configure Traefik on staging node
  import_playbook: staging-traefik.yaml
  when:
    - groups.get('staging', []) | length > 0
    - air_gapped | default(false) | bool

- name: Install K3s
  import_playbook: k3s.yaml

- name: Configure traefik
  import_playbook: traefik.yaml

- name: Install Helm
  import_playbook: helm.yaml

- name: Install GPU Operator and Services
  import_playbook: gpu.yaml
  when: groups.get('gpu_workers', []) | length > 0

- name: Install Postgres
  import_playbook: postgres.yaml

- name: Install Auth
  import_playbook: auth.yaml

- name: Install Lake
  import_playbook: lake.yaml

- name: Install Analytics
  import_playbook: analytics.yaml

- name: Install Orchestrator
  import_playbook: orchestrator.yaml

- name: Install Extractor
  import_playbook: extractor.yaml

- name: Install Jupyter
  import_playbook: jupyter.yaml

- name: Install Monitor
  import_playbook: monitor.yaml

- name: Install Launchpad
  import_playbook: launchpad.yaml
