---
# K3s Installation Playbook
# Installs k3s on server and agent nodes
# Supports both online and air-gapped deployment modes
#
# Documentation:
#   - Inventory configuration: docs/source/technical/inventory.md
#   - Air-gapped deployment: docs/source/technical/air-gapped.md
#   - Role details: ansible/roles/k3s/README.md

- name: Install Python kubernetes library on cluster nodes
  hosts: k3s_cluster
  tasks:
    - name: Include python-kubernetes role
      ansible.builtin.include_role:
        name: python-kubernetes

- name: Install k3s cluster
  hosts: k3s_cluster
  roles:
    - scout_common
    - k3s
  environment:
    KUBECONFIG: '{{ kubeconfig_yaml }}'

- name: Configure custom storage classes
  hosts: server
  tasks:
    - name: Configure storage classes for multi-disk deployments
      ansible.builtin.import_role:
        name: scout_common
        tasks_from: storage_classes
