---
# K3s Installation Playbook
# Installs k3s on server and agent nodes using the k3s role
# Supports both online and air-gapped deployment modes
#
# Required inventory groups:
#   - k3s_cluster: All k3s nodes (server + agents + gpu_workers)
#   - server: k3s server node(s)
#   - agents: k3s agent nodes (optional)
#   - gpu_workers: k3s agent nodes with GPU support (optional, subset of agents)
#   - staging: Staging node for air-gapped deployments (optional)
#
# Required variables:
#   - k3s_token: Cluster join token
#
# Optional variables:
#   - air_gapped: Enable air-gapped mode (default: false)
#   - k3s_version: k3s version to install (default: latest stable)
#   - base_dir: k3s data directory (default: /var/lib/rancher/k3s)
#
# See ansible/roles/k3s/README.md for full documentation

################################################################################
- name: Install k3s cluster
  hosts: k3s_cluster
  roles:
    - scout_common
    - k3s
  environment:
    KUBECONFIG: '{{ kubeconfig_yaml }}'

################################################################################
- name: Set up kubeconfig on server node
  hosts: server
  environment:
    KUBECONFIG: '{{ kubeconfig_yaml }}'
  tasks:
    - name: Set up kubeconfig
      include_tasks: tasks/set_up_kubeconfig.yaml
