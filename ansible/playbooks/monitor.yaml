---
- name: Create storage directories for monitoring
  hosts: k3s_cluster
  gather_facts: false
  tasks:
    - name: Create Prometheus storage directories
      ansible.builtin.include_role:
        name: prometheus
        tasks_from: storage

    - name: Create Loki storage directories
      ansible.builtin.include_role:
        name: loki
        tasks_from: storage

    - name: Create Grafana storage directories
      ansible.builtin.include_role:
        name: grafana
        tasks_from: storage

- name: Install monitoring components
  hosts: server
  gather_facts: false
  environment:
    KUBECONFIG: '{{ kubeconfig_yaml }}'
    K8S_AUTH_KUBECONFIG: '{{ kubeconfig_yaml }}'
  roles:
    - prometheus
    - loki
    - grafana
