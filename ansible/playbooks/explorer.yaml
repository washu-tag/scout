---
- name: Install explorer
  hosts: server
  gather_facts: false
  environment:
    KUBECONFIG: '{{ kubeconfig_yaml }}'

  tasks:
    - name: Deploy explorer
      ansible.builtin.include_tasks: tasks/deploy_helm_chart.yaml
      vars:
        helm_chart_name: explorer
        helm_chart_ref: '{{ scout_repo_dir }}/helm/explorer'
        helm_chart_namespace: explorer
        helm_chart_create_namespace: true
        helm_chart_wait: true
        helm_chart_timeout: 5m
        helm_chart_values_files:
          - '{{ scout_repo_dir }}/helm/explorer/values.yaml'
        helm_chart_values:
          image:
            repository: '{{ explorer_image | default(omit) }}'
            tag: '{{ explorer_image_tag | default(omit) }}'
          ingress:
            enabled: true
            className: traefik
            hosts:
              - host: '{{ server_hostname }}'
                paths:
                  - path: /
                    pathType: Prefix
