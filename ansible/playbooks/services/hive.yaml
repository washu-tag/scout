---
- name: Load values file
  ansible.builtin.include_vars:
    file: vars/hive.values.yaml
    name: hive_values

- name: Deploy Hive Metastore Service
  ansible.builtin.include_tasks: ../tasks/deploy_helm_chart.yaml
  vars:
    helm_chart_name: hive-metastore
    helm_chart_ref: '{{ scout_repo_dir }}/helm/lake/hive-metastore'
    helm_chart_namespace: '{{ hive_namespace }}'
    helm_chart_create_namespace: true
    helm_chart_wait: true
    helm_chart_timeout: 5m
    helm_chart_values: '{{ hive_values }}'

- name: Wait for Hive to be ready
  command: 'kubectl -n {{ hive_namespace }} wait --for=condition=Available --timeout=300s deployments/hive-metastore'
  register: hive_ready
  changed_when: false
