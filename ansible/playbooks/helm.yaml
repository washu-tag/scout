---
# Install Helm and helm-diff plugin
# Behavior depends on air_gapped variable:
# - Non-air-gapped: Install on server nodes (standard deployment)
# - Air-gapped: Install on Ansible control node (localhost)
#
# In air-gapped mode, Helm charts are deployed from localhost using
# delegate_to: localhost with remote kubeconfig access

- name: Install Helm on server nodes (non-air-gapped mode)
  hosts: server
  gather_facts: false
  when: not (air_gapped | default(false) | bool)
  roles:
    - role: helm
      vars:
        helm_script_dir: /root/bin

- name: Install Helm on Ansible control node (air-gapped mode)
  hosts: localhost
  gather_facts: true
  when: air_gapped | default(false) | bool
  roles:
    - role: helm
      vars:
        helm_script_dir: '{{ ansible_env.HOME }}/.local/bin'
