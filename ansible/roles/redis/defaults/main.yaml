---
# Defaults for redis role
# User-configurable settings are in inventory.yaml

# Redis Enterprise Operator Helm chart configuration
redis_helm_repo: https://helm.redis.io
redis_helm_repo_name: redis-enterprise
redis_helm_chart_name: redis-enterprise-operator
redis_helm_release_name: redis-enterprise-operator

# Storage naming
redis_name: redis
redis_storage_class: '{{ redis_name }}-storage'
redis_storage_size: 8Gi

# Storage definitions for persistent volumes
# Dynamically generated based on k3s_cluster inventory group and redis_cluster_nodes
redis_storage_definitions_raw: >-
  [{% set ns = namespace(counter=0) -%}
  {% for node_url in groups["k3s_cluster"] -%}
    {% if ns.counter < redis_cluster_nodes -%}
      {
        "name": "{{ redis_name }}-{{ node_url }}",
        "size": "{{ redis_storage_size }}",
        "path": "{{ redis_dir }}",
        "pv_name": "{{ redis_name }}-pv-{{ node_url }}",
        "storage_class_name": "{{ redis_storage_class }}",
        "node_url": "{{ node_url }}"
      }{% if ns.counter < (redis_cluster_nodes - 1) %},{% endif %}
      {% set ns.counter = ns.counter + 1 -%}
    {%- endif %}
  {%- endfor %}]
redis_storage_definitions: '{{ redis_storage_definitions_raw if not (redis_storage_definitions_raw is string) else (redis_storage_definitions_raw | from_yaml) }}'

# General database settings (used for all Redis databases)
redis_database_port: 6379

# Redis authentication
# redis_password: defined in inventory.yaml (use vault encryption)

# Operator resources
redis_operator_resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 256Mi

# Redis Enterprise Cluster node resources
redis_cluster_node_resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 4Gi

# Number of Redis Enterprise nodes (minimum 3 for HA)
redis_cluster_nodes: 3

# Redis Enterprise Cluster persistence
redis_cluster_persistence_enabled: true
