---
# k3s Air-Gapped Installation - Main Task Logic
# Entry point for air-gapped k3s preparation role
# Handles artifact staging and SELinux package installation
# The actual k3s installation is handled by the k3s.yaml playbook

- name: Display installation mode
  ansible.builtin.debug:
    msg: 'Preparing for air-gapped k3s installation'

- name: Download k3s artifacts to Ansible control node
  ansible.builtin.include_tasks: download_artifacts.yaml

- name: Copy k3s binary to node
  ansible.builtin.copy:
    src: '{{ k3s_artifact_temp_dir }}/k3s'
    dest: '{{ k3s_binary_path }}'
    mode: '0755'

- name: Copy k3s install script to node
  ansible.builtin.copy:
    src: '{{ k3s_artifact_temp_dir }}/install-k3s.sh'
    dest: '{{ k3s_install_script_path }}'
    mode: '0755'

- name: Install SELinux packages
  ansible.builtin.include_tasks: selinux.yaml
  when: k3s_selinux_enabled | bool
