---
# Verify playbook - asserts that the role defaults are correctly defined
# This is a lightweight check that doesn't run the full deployment

- name: Verify
  hosts: localhost
  gather_facts: false
  vars_files:
    - ../../defaults/main.yaml
    - ../../../scout_common/defaults/main.yaml

  tasks:
    - name: Verify postgres parameters are defined
      ansible.builtin.assert:
        that:
          - postgres_parameters is defined
          - postgres_parameters is mapping
          - postgres_parameters.max_connections is defined
        fail_msg: 'postgres_parameters should be defined with required keys'
        success_msg: '✓ postgres_parameters are properly configured'

    - name: Verify role defaults are set
      ansible.builtin.assert:
        that:
          - postgres_storage_class is defined
          - postgres_storage_size is defined
        fail_msg: 'Required role defaults are missing'
        success_msg: '✓ All required role defaults are set'
