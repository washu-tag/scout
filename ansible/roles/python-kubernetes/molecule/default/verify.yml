---
- name: Verify
  hosts: all
  tasks:
    - name: Verify python3-kubernetes is installed
      ansible.builtin.command: python3 -c "import kubernetes; print(kubernetes.__version__)"
      register: python_version
      changed_when: false
      failed_when: python_version.rc != 0

    - name: Display version
      ansible.builtin.debug:
        msg: 'python3-kubernetes version: {{ python_version.stdout }}'

    - name: Verify python3-kubernetes package is installed
      ansible.builtin.package:
        name: python3-kubernetes
        state: present
      check_mode: true
      register: package_check
      failed_when: package_check is changed
