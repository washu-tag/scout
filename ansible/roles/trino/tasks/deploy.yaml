---
# Deploy Trino using Helm with file-based access control

- name: Validate required Trino passwords
  ansible.builtin.assert:
    that:
      - trino_admin_password is defined
      - trino_admin_password | length > 0
      - trino_readonly_password is defined
      - trino_readonly_password | length > 0
    fail_msg: >
      Trino passwords (trino_admin_password and trino_readonly_password) are required for authentication.
      Please set them in your inventory.yaml (use vault encryption).
      Example: openssl rand -hex 32 | ansible-vault encrypt_string --vault-password-file vault/pwd.sh
    quiet: true

- name: Deploy Trino
  ansible.builtin.include_role:
    name: scout_common
    tasks_from: deploy_helm_chart
  vars:
    helm_chart_name: trino
    helm_chart_ref: '{{ trino_helm_repo_name }}/{{ trino_helm_chart_name }}'
    helm_chart_version: '{{ trino_helm_chart_version }}'
    helm_chart_namespace: '{{ trino_namespace }}'
    helm_repo_name: '{{ trino_helm_repo_name }}'
    helm_repo_url: '{{ trino_helm_repo_url }}'
    helm_chart_values: "{{ lookup('template', 'values.yaml.j2') | from_yaml }}"
