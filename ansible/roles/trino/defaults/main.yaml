---
# Trino role defaults
# User-configurable settings are in inventory.yaml

# Trino Helm configuration
trino_helm_repo_name: trino
trino_helm_repo_url: https://trinodb.github.io/charts
trino_helm_chart_name: trino

# Resource sizing - users should override these in inventory
# Worker count
trino_worker_count: 2 # Number of worker replicas

# Memory
trino_worker_max_heap: 2G # JVM heap size for workers
trino_coordinator_max_heap: 1G # JVM heap size for coordinator

# Query memory allocation (Trino recommendation: 30% of heap)
# Per https://trino.io/docs/current/admin/properties-resource-management.html
trino_per_node_query_memory_fraction: 0.3 # Fraction of heap allocated to query.max-memory-per-node

# CPU (dev defaults - CI friendly)
trino_worker_cpu_request: 250m
trino_worker_cpu_limit: 2
trino_coordinator_cpu_request: 250m
trino_coordinator_cpu_limit: 1

# Resource configuration (dev defaults - CI friendly)
# Consolidated resource blocks for templates
trino_coordinator_resources:
  requests:
    cpu: '{{ trino_coordinator_cpu_request }}'
    memory: '{{ trino_coordinator_max_heap | jvm_memory_to_k8s }}'
  limits:
    cpu: '{{ trino_coordinator_cpu_limit }}'
    memory: '{{ trino_coordinator_max_heap | jvm_memory_to_k8s(2) }}'

trino_worker_resources:
  requests:
    cpu: '{{ trino_worker_cpu_request }}'
    memory: '{{ trino_worker_max_heap | jvm_memory_to_k8s }}'
  limits:
    cpu: '{{ trino_worker_cpu_limit }}'
    memory: '{{ trino_worker_max_heap | jvm_memory_to_k8s(2) }}'

# Trino MCP server configuration
mcp_trino_enabled: true
mcp_trino_repo_url: https://github.com/tuannvm/mcp-trino.git
mcp_trino_repo_version: 'v{{ mcp_trino_version }}'
mcp_trino_chart_path: /tmp/mcp-trino-chart
mcp_trino_release_name: mcp-trino

# Trino connection settings for MCP (uses read-only user)
mcp_trino_host: trino
mcp_trino_port: 8080
mcp_trino_scheme: http
mcp_trino_user: '{{ trino_readonly_user }}'

# Trino MCP Helm values
mcp_trino_values:
  replicaCount: 1
  image:
    tag: '{{ mcp_trino_version }}'
  trino:
    host: '{{ mcp_trino_host }}'
    port: '{{ mcp_trino_port }}'
    scheme: '{{ mcp_trino_scheme }}'
    ssl: false
    user: '{{ mcp_trino_user }}'
    catalog: delta
    schema: default
    allowWriteQueries: false
    queryTimeout: 600
    allowlists:
      catalogs: [delta]
      schemas: [delta.default]
      tables: []
  service:
    type: ClusterIP
    port: 8080
