---
# Jupyter role defaults
# User-configurable settings are in inventory.yaml

# Helm configuration
jupyter_helm_repo_name: jupyterhub
jupyter_helm_repo_url: https://raw.githubusercontent.com/jupyterhub/helm-chart/refs/heads/gh-pages/
jupyter_helm_chart_name: jupyterhub

# Storage configuration
jupyter_hub_storage_size: 1Gi
jupyter_singleuser_storage_size: 10Gi

# Storage class for JupyterHub database
# Leave empty to use cluster default storage class
jupyterhub_storage_class: ''

# Storage class for Jupyter notebooks
# Leave empty to use cluster default storage class
jupyter_singleuser_storage_class: ''

# Single-user image configuration
jupyter_singleuser_image_name: ghcr.io/washu-tag/pyspark-notebook
jupyter_singleuser_image_tag: 1.1.0

# API tokens for JupyterHub services
# REQUIRED: Must be set in inventory.yaml (use vault encryption)
# Example: openssl rand -hex 32 | ansible-vault encrypt_string --vault-password-file vault/pwd.sh
jupyter_metrics_api_token: ''

# PrePuller configuration
jupyter_prepuller_continuous: false

# Extension Manager Configuration
# Controls JupyterLab extension installation capabilities
# Options:
#   'disabled' - Completely hide Extension Manager UI (recommended for air-gapped/production)
#   'readonly' - Show installed extensions only, no installation allowed
#   'enabled' - Full extension management (default JupyterLab behavior)
# Note: In air-gapped environments, users cannot install extensions anyway due to lack of PyPI access
jupyter_extension_manager_mode: 'disabled'

# Branding
jupyter_logo_path: '{{ scout_repo_dir }}/launchpad/public/scout.png'

# Jupyter resources
jupyter_hub_resources:
  requests:
    cpu: 100m
    memory: 256M
  limits:
    cpu: 500m
    memory: 512M
jupyter_cpu_profile:
  display_name: 'CPU Only'
  slug: 'cpu'
  description: 'CPU only environment for data analysis'
  default: true
  profile_options:
    resource_allocation:
      display_name: 'Size'
      choices:
        small:
          display_name: 'Small (1 CPU, 4Gi RAM)'
          kubespawner_override:
            cpu_guarantee: 0.5
            cpu_limit: 1
            mem_guarantee: '1G'
            mem_limit: '4G'
            environment:
              SPARK_DRIVER_MEMORY: '3g'
              SPARK_EXECUTOR_MEMORY: '3g'
        medium:
          display_name: 'Medium (2 CPU, 8Gi RAM)'
          kubespawner_override:
            cpu_guarantee: 1
            cpu_limit: 2
            mem_guarantee: '2G'
            mem_limit: '8G'
            environment:
              SPARK_DRIVER_MEMORY: '6g'
              SPARK_EXECUTOR_MEMORY: '6g'
        large:
          display_name: 'Large (4 CPU, 16Gi RAM)'
          default: true
          kubespawner_override:
            cpu_guarantee: 2
            cpu_limit: 4
            mem_guarantee: '4G'
            mem_limit: '16G'
            environment:
              SPARK_DRIVER_MEMORY: '12g'
              SPARK_EXECUTOR_MEMORY: '12g'
jupyter_profiles:
  - '{{ jupyter_cpu_profile }}'

# jupyterhub-idle-culler settings
jupyter_cull_enabled: true
jupyter_cull_every: 600
jupyter_cull_max_age: 172800
jupyter_cull_remove_named_servers: true
jupyter_cull_concurrency: 10
