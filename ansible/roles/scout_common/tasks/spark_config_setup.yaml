---
# Create Spark configuration ConfigMap
# This is used by JupyterHub and other Spark-enabled services
#
# Parameters:
#   spark_hive_metastore_uri: Which Hive metastore to connect to
#     - Pass hive_metastore_endpoint for write access (HL7 transformer, extractors)
#     - Pass hive_metastore_endpoint_readonly for readonly access (Jupyter)
#     - Defaults to hive_metastore_endpoint (write) for backward compatibility

- name: Render Spark defaults configuration
  ansible.builtin.set_fact:
    spark_defaults_conf_content: "{{ lookup('template', 'spark-defaults.conf.j2') }}"

- name: Create Spark ConfigMap
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: '{{ spark_defaults_configmap_name }}'
        namespace: '{{ spark_defaults_configmap_namespace }}'
      data:
        spark-defaults.conf: '{{ spark_defaults_conf_content }}'
