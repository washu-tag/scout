---
# Defaults for scout_common role
# This role contains shared tasks and default configuration values
# All values here can be overridden in inventory.yaml
timezone: 'America/Chicago'

# Storage class configuration
# Custom storage classes for k3s on-prem deployments with multiple disks requiring I/O isolation
# Leave empty for cloud deployments or single-disk k3s (cluster default will be used)
onprem_local_path_multidisk_storage_classes: []

# Helm deployment defaults
helm_chart_create_namespace: true
helm_chart_wait: true
helm_chart_timeout: '5m'
helm_chart_values: {}
helm_chart_values_files: []

# Custom images (override from inventory for CI/CD)
# Launchpad: launchpad_image_repository and launchpad_image_tag (see roles/launchpad/defaults/main.yaml)
# Superset: superset_image_repository and superset_image_tag (see roles/superset/defaults/main.yaml)
# Jupyter: jupyter_singleuser_image_name and jupyter_singleuser_image_tag (see roles/jupyter/defaults/main.yaml)
# Extractors: hl7log_extractor_image_repository/tag and hl7_transformer_image_repository/tag (see roles/extractor/defaults/main.yaml)

# Kubernetes configuration
kubeconfig_yaml: /etc/rancher/k3s/k3s.yaml
air_gapped: false

# Local kubeconfig path - USE THIS in all tasks that need kubeconfig
# The k3s role may override this via set_fact to point to a local copy of the kubeconfig
# with updated server address for remote access. Defaults to kubeconfig_yaml.
# This centralizes the pattern: {{ local_kubeconfig_yaml | default(kubeconfig_yaml) }}
local_kubeconfig_yaml: '{{ kubeconfig_yaml }}'

# Package Management Configuration (for air-gapped RPM downloads via Kubernetes Jobs)
package_download_namespace: default
package_download_timeout: 300
package_download_image: rockylinux/rockylinux:9.6

# Package installation timeout (seconds) - applies to dnf/yum install operations
# Set to 0 to disable timeout
package_install_timeout: 300

# Consolidated Namespaces (6 primary namespaces)
scout_core_namespace: scout-core
scout_data_namespace: scout-data
scout_extractor_namespace: scout-extractor
scout_analytics_namespace: scout-analytics
scout_operators_namespace: scout-operators
scout_monitoring_namespace: scout-monitoring

# System namespaces (kept separate)
traefik_namespace: kube-system
harbor_namespace: harbor

# Service-to-namespace mappings
# Core infrastructure
postgres_cluster_namespace: '{{ scout_core_namespace }}'
keycloak_namespace: '{{ scout_core_namespace }}'
redis_namespace: '{{ scout_core_namespace }}'
launchpad_namespace: '{{ scout_core_namespace }}'

# Data layer
minio_tenant_namespace: '{{ scout_data_namespace }}'
hive_namespace: '{{ scout_data_namespace }}'
dcm4chee_namespace: '{{ scout_data_namespace }}'
orthanc_namespace: '{{ scout_data_namespace }}'

# Extractor & workflow orchestration
extractor_namespace: '{{ scout_extractor_namespace }}'

# Analytics & user services
trino_namespace: '{{ scout_analytics_namespace }}'
superset_namespace: '{{ scout_analytics_namespace }}'
jupyter_namespace: '{{ scout_analytics_namespace }}'
chatbot_namespace: '{{ scout_analytics_namespace }}'

# Operators
cnpg_operator_namespace: '{{ scout_operators_namespace }}'
minio_operator_namespace: '{{ scout_operators_namespace }}'
eck_operator_namespace: '{{ scout_operators_namespace }}'
gpu_operator_namespace: '{{ scout_operators_namespace }}'
cert_manager_namespace: '{{ scout_operators_namespace }}'

# Monitoring
prometheus_namespace: '{{ scout_monitoring_namespace }}'
grafana_namespace: '{{ scout_monitoring_namespace }}'
loki_namespace: '{{ scout_monitoring_namespace }}'

# OAuth configuration
oauth_provider_name: Keycloak # User-facing name for OAuth provider (e.g., 'WashU Key', 'Keycloak')

# Keycloak OAuth client IDs and secrets (client secrets must be defined in inventory)
keycloak_oauth2_proxy_client_id: oauth2-proxy
keycloak_superset_client_id: superset
keycloak_jupyterhub_client_id: jupyterhub
keycloak_grafana_client_id: grafana
keycloak_temporal_client_id: temporal
keycloak_minio_client_id: minio
keycloak_launchpad_client_id: launchpad
keycloak_open_webui_client_id: open-webui

# Open WebUI URLs
open_webui_callback_url: 'https://chat.{{ server_hostname }}/oauth/oidc/callback'

# S3/MinIO configuration (passwords defined in inventory)
s3_region: us-east-1
s3_username: minio
s3_lake_reader: lake-reader
s3_lake_writer: lake-writer
s3_loki_writer: loki-writer
lake_bucket: lake
scratch_bucket: scratch
loki_chunks_bucket: loki-chunks
loki_ruler_bucket: loki-ruler
loki_admin_bucket: loki-admin

# Deployment Type
deployment_type: onprem

# Database
postgres_cluster_name: postgresql-cluster

# Usernames (passwords defined in inventory)
postgres_user: scout
hive_postgres_user: hive
hive_readonly_postgres_user: hive_readonly
superset_postgres_user: superset
keycloak_postgres_user: keycloak

# Database names
hive_database_name: hive
superset_database_name: superset

# Table names
report_delta_table_name: reports
ingest_postgres_table_name: ingest

# Hive deployment
hive_metastore_instance: hive-metastore
hive_metastore_instance_readonly: hive-metastore-readonly

# Trino - this is a dummy username since all Trino access is RO
trino_user: trino

# Helm configuration
helm_plugins_dir: /root/.local/share/helm/plugins

# Object storage paths (use variables for bucket names)
scratch_path: 's3://{{ scratch_bucket }}'
delta_lake_path: 's3a://{{ lake_bucket }}/delta' # Hadoop requires the s3a prefix

# OAuth2 Proxy configuration
oauth2_proxy_subdomain: auth

# Keycloak configuration (DO NOT CHANGE)
# The realm and subdomain values are hardcoded in Launchpad.
# These variables are used for constructing the authentication URLs below.
keycloak_realm_name: scout
keycloak_subdomain: keycloak

# Feature flags (override from inventory to enable/disable features)
enable_chat: false

# Computed values (DO NOT CHANGE)
s3_endpoint: 'http://minio.{{ minio_tenant_namespace }}'
hive_metastore_endpoint: 'thrift://{{ hive_metastore_instance }}.{{ hive_namespace }}:9083'
hive_metastore_endpoint_readonly: 'thrift://{{ hive_metastore_instance_readonly }}.{{ hive_namespace }}:9083'
server_hostname: '{{ hostvars[groups["server"][0]].external_url | default(groups["server"][0]) }}'
aws_deployment: "{{ deployment_type | trim | lower == 'aws' }}"
db_host: '{{ postgres_cluster_name }}-rw.{{ postgres_cluster_namespace }}'
db_host_ro: '{{ postgres_cluster_name }}-r.{{ postgres_cluster_namespace }}'
db_port: 5432
jdbc_url: 'jdbc:postgresql://{{ db_host }}:{{ db_port }}'
keycloak_base_url: 'https://{{ keycloak_subdomain }}.{{ server_hostname }}'
keycloak_realm_url: '{{ keycloak_base_url }}/realms/{{ keycloak_realm_name }}'
keycloak_oidc_auth_url: '{{ keycloak_realm_url }}/protocol/openid-connect/auth'
keycloak_oidc_token_url: '{{ keycloak_realm_url }}/protocol/openid-connect/token'
keycloak_oidc_userinfo_url: '{{ keycloak_realm_url }}/protocol/openid-connect/userinfo'
keycloak_oidc_certs_url: '{{ keycloak_realm_url }}/protocol/openid-connect/certs'
keycloak_oidc_logout_url: '{{ keycloak_realm_url }}/protocol/openid-connect/logout'
keycloak_wellknown_url: '{{ keycloak_realm_url }}/.well-known/openid-configuration'
oauth2_proxy_base_url: 'https://{{ oauth2_proxy_subdomain }}.{{ server_hostname }}'
oauth2_proxy_callback_url: '{{ oauth2_proxy_base_url }}/oauth2/callback'
oauth2_proxy_signout_url: '{{ oauth2_proxy_base_url }}/oauth2/sign_out'
oauth2_proxy_auth_url: '{{ oauth2_proxy_base_url }}/oauth2/auth'
