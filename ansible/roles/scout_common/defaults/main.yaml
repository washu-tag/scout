---
# Defaults for scout_common role
# This role contains shared tasks and default configuration values
# All values here can be overridden in inventory.yaml
timezone: 'America/Chicago'

# Helm deployment defaults
helm_chart_create_namespace: true
helm_chart_wait: true
helm_chart_timeout: '5m'
helm_chart_values: {}
helm_chart_values_files: []

# Custom images (override from inventory for CI/CD)
# Launchpad: launchpad_image_repository and launchpad_image_tag (see roles/launchpad/defaults/main.yaml)
# Superset: superset_image_repository and superset_image_tag (see roles/superset/defaults/main.yaml)
# Jupyter: jupyter_singleuser_image_name and jupyter_singleuser_image_tag (see roles/jupyter/defaults/main.yaml)
# Extractors: hl7log_extractor_image_repository/tag and hl7_transformer_image_repository/tag (see roles/extractor/defaults/main.yaml)

# Kubernetes configuration
kubeconfig_yaml: /etc/rancher/k3s/k3s.yaml
air_gapped: false

# Local kubeconfig path - USE THIS in all tasks that need kubeconfig
# The k3s role may override this via set_fact to point to a local copy of the kubeconfig
# with updated server address for remote access. Defaults to kubeconfig_yaml.
# This centralizes the pattern: {{ local_kubeconfig_yaml | default(kubeconfig_yaml) }}
local_kubeconfig_yaml: '{{ kubeconfig_yaml }}'

# Package Management Configuration (for air-gapped RPM downloads via Kubernetes Jobs)
package_download_namespace: default
package_download_timeout: 300
package_download_image: rockylinux/rockylinux:9.6

# Package installation timeout (seconds) - applies to dnf/yum install operations
# Set to 0 to disable timeout
package_install_timeout: 300

# Default namespaces
cnpg_operator_namespace: cnpg-operator
postgres_cluster_namespace: cnpg
prometheus_namespace: prometheus
grafana_namespace: grafana
loki_namespace: loki
gpu_operator_namespace: gpu-operator
extractor_namespace: extractor
minio_operator_namespace: minio-operator
minio_tenant_namespace: minio-scout
hive_namespace: hive
temporal_namespace: temporal
cassandra_namespace: cassandra
cert_manager_namespace: cert-manager
eck_operator_namespace: eck-operator
elasticsearch_namespace: elastic
chatbot_namespace: chatbot
jupyter_namespace: jupyter
superset_namespace: superset
trino_namespace: trino
harbor_namespace: harbor
orthanc_namespace: orthanc
dcm4chee_namespace: dcm4chee
launchpad_namespace: launchpad
keycloak_namespace: keycloak
redis_namespace: redis

# Keycloak OAuth client IDs and secrets (client secrets must be defined in inventory)
keycloak_oauth2_proxy_client_id: oauth2-proxy
keycloak_superset_client_id: superset
keycloak_jupyterhub_client_id: jupyterhub
keycloak_grafana_client_id: grafana
keycloak_temporal_client_id: temporal
keycloak_minio_client_id: minio
keycloak_launchpad_client_id: launchpad
keycloak_open_webui_client_id: open-webui

# S3/MinIO configuration (passwords defined in inventory)
s3_region: us-east-1
s3_username: minio
s3_lake_reader: lake-reader
s3_lake_writer: lake-writer
s3_loki_writer: loki-writer
lake_bucket: lake
scratch_bucket: scratch

# Deployment Type
deployment_type: onprem

# Database
postgres_cluster_name: postgresql-cluster

# Usernames (passwords defined in inventory)
postgres_user: scout
hive_postgres_user: hive
hive_readonly_postgres_user: hive_readonly
superset_postgres_user: superset
keycloak_postgres_user: keycloak

# Database names
hive_database_name: hive
superset_database_name: superset

# Table names
report_delta_table_name: reports
ingest_postgres_table_name: ingest

# Hive deployment
hive_metastore_instance: hive-metastore
hive_metastore_instance_readonly: hive-metastore-readonly

# Trino - this is a dummy username since all Trino access is RO
trino_user: trino

# Helm configuration
helm_plugins_dir: /root/.local/share/helm/plugins

# Container mounted paths
modality_map_path: /data/modality_mapping_codes.csv

# Object storage paths (use variables for bucket names)
scratch_path: 's3://{{ scratch_bucket }}'
delta_lake_path: 's3a://{{ lake_bucket }}/delta' # Hadoop requires the s3a prefix

# OAuth2 Proxy configuration
oauth2_proxy_subdomain: auth

# Keycloak configuration (DO NOT CHANGE)
# The realm and subdomain values are hardcoded in Launchpad.
# These variables are used for constructing the authentication URLs below.
keycloak_realm_name: scout
keycloak_subdomain: keycloak

# Computed values (DO NOT CHANGE)
s3_endpoint: 'http://minio.{{ minio_tenant_namespace }}'
hive_metastore_endpoint: 'thrift://{{ hive_metastore_instance }}.{{ hive_namespace }}:9083'
hive_metastore_endpoint_readonly: 'thrift://{{ hive_metastore_instance_readonly }}.{{ hive_namespace }}:9083'
server_hostname: '{{ hostvars[groups["server"][0]].external_url | default(groups["server"][0]) }}'
aws_deployment: "{{ deployment_type | trim | lower == 'aws' }}"
db_host: '{{ postgres_cluster_name }}-rw.{{ postgres_cluster_namespace }}'
db_host_ro: '{{ postgres_cluster_name }}-r.{{ postgres_cluster_namespace }}'
db_port: 5432
jdbc_url: 'jdbc:postgresql://{{ db_host }}:{{ db_port }}'
use_custom_storage_classes: '{{ not aws_deployment }}'
keycloak_base_url: 'https://{{ keycloak_subdomain }}.{{ server_hostname }}'
keycloak_realm_url: '{{ keycloak_base_url }}/realms/{{ keycloak_realm_name }}'
keycloak_oidc_auth_url: '{{ keycloak_realm_url }}/protocol/openid-connect/auth'
keycloak_oidc_token_url: '{{ keycloak_realm_url }}/protocol/openid-connect/token'
keycloak_oidc_userinfo_url: '{{ keycloak_realm_url }}/protocol/openid-connect/userinfo'
keycloak_oidc_certs_url: '{{ keycloak_realm_url }}/protocol/openid-connect/certs'
keycloak_oidc_logout_url: '{{ keycloak_realm_url }}/protocol/openid-connect/logout'
keycloak_wellknown_url: '{{ keycloak_realm_url }}/.well-known/openid-configuration'
oauth2_proxy_base_url: 'https://{{ oauth2_proxy_subdomain }}.{{ server_hostname }}'
oauth2_proxy_callback_url: '{{ oauth2_proxy_base_url }}/oauth2/callback'
oauth2_proxy_signout_url: '{{ oauth2_proxy_base_url }}/oauth2/sign_out'
oauth2_proxy_auth_url: '{{ oauth2_proxy_base_url }}/oauth2/auth'
