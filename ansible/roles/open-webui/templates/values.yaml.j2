nameOverride: ''
namespaceOverride: ''
ollama:
  # -- Automatically install Ollama Helm chart from https://otwld.github.io/ollama-helm/. Use [Helm Values](https://github.com/otwld/ollama-helm/#helm-values) to configure
  enabled: true
  # -- If enabling embedded Ollama, update fullnameOverride to your desired Ollama name value, or else it will use the default ollama.name value from the Ollama chart
  fullnameOverride: ollama
  ollama:
    gpu:
      enabled: true
      type: 'nvidia'
      number: 1
    models:
      pull: []  # Models are pulled asynchronously via separate Job to avoid Helm timeout
  resources: {{ ollama_resources | to_json }}
  persistentVolume:
    enabled: true
    storageClass: {{ ollama_storage_class }}
    size: {{ ollama_storage_size }}

pipelines:
  enabled: false

ingress:
  enabled: true
  class: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.middlewares: >-
      kube-system-oauth2-proxy-error@kubernetescrd,
      kube-system-oauth2-proxy-auth@kubernetescrd
  host: chat.{{ server_hostname }}

persistence:
  enabled: true
  storageClass: {{ open_webui_storage_class }}
  size: {{ open_webui_storage_size }}

resources: {{ open_webui_resources | to_json }}

# -- Configure database URL, needed to work with Postgres (example: `postgresql://<user>:<password>@<service>:<port>/<database>`), leave empty to use the default sqlite database
databaseUrl: 'postgresql://{{ open_webui_postgres_user }}:{{ open_webui_postgres_password }}@{{ db_host }}:{{ db_port }}/{{ open_webui_database }}'

enableOpenaiApi: false

websocket:
  # -- Enables websocket support in Open WebUI with env `ENABLE_WEBSOCKET_SUPPORT`
  enabled: true
  # Use external Redis for websocket coordination
  manager: redis
  url: '{{ open_webui_redis_url }}'
  redis:
    # Disable embedded Redis - using external Redis Enterprise Database
    enabled: false

# OAuth/OIDC Configuration for Keycloak integration
# OAuth2 Proxy provides initial authentication gate (checks scout-user group)
# Open WebUI's OIDC handles login and role mapping to admin/user roles
extraEnvVars:
  # WebUI secret key for session management and OAuth security
  - name: WEBUI_SECRET_KEY
    value: '{{ open_webui_secret_key }}'

  # Disable local authentication (email/password)
  - name: ENABLE_SIGNUP
    value: 'false'

  - name: ENABLE_LOGIN_FORM
    value: 'false'

  # Enable OAuth signup and authentication
  - name: ENABLE_OAUTH_SIGNUP
    value: 'true'

  # OAuth provider configuration
  - name: OAUTH_PROVIDER_NAME
    value: '{{ oauth_provider_name }}'

  # OAuth client credentials
  - name: OAUTH_CLIENT_ID
    value: '{{ keycloak_open_webui_client_id }}'

  - name: OAUTH_CLIENT_SECRET
    value: '{{ keycloak_open_webui_client_secret }}'

  # OIDC endpoints (uses Keycloak well-known configuration)
  - name: OPENID_PROVIDER_URL
    value: '{{ keycloak_wellknown_url }}'

  # OAuth redirect URI
  - name: OPENID_REDIRECT_URI
    value: 'https://chat.{{ server_hostname }}/oauth/oidc/callback'

  # OAuth scopes
  - name: OAUTH_SCOPES
    value: 'openid email profile'

  # Merge accounts by email
  - name: OAUTH_MERGE_ACCOUNTS_BY_EMAIL
    value: 'true'

  # Web UI URL (required for OAuth in clustered environments)
  - name: WEBUI_URL
    value: 'https://chat.{{ server_hostname }}'

  # Enable role management
  - name: ENABLE_OAUTH_ROLE_MANAGEMENT
    value: 'true'

  # Role claim path (Keycloak client roles)
  - name: OAUTH_ROLES_CLAIM
    value: 'resource_access.{{ keycloak_open_webui_client_id }}.roles'

  # Allowed roles (users with these roles can log in)
  - name: OAUTH_ALLOWED_ROLES
    value: 'open-webui-user,open-webui-admin'

  # Admin roles
  - name: OAUTH_ADMIN_ROLES
    value: 'open-webui-admin'

  # Allow OAuth config updates via env vars (not persistent in DB)
  - name: ENABLE_OAUTH_PERSISTENT_CONFIG
    value: 'false'

  # Redis for distributed state management (shares same Redis as websockets)
  # Required for multi-replica deployments to share config and state
  - name: REDIS_URL
    value: '{{ open_webui_redis_url }}'
