---
# Python kubernetes Library Installation
# Installs python3-kubernetes package required by Ansible kubernetes.core modules
# Handles both online and air-gapped installation modes

- name: Display Python kubernetes installation mode
  ansible.builtin.debug:
    msg: "Installing python3-kubernetes via {{ 'downloaded RPMs (air-gapped)' if air_gapped | default(false) | bool else 'system package manager (online)' }}"

- name: Install python3-kubernetes from local RPMs (air-gapped mode)
  when: air_gapped | default(false) | bool
  ansible.builtin.include_tasks: install_rpms_from_artifacts.yaml
  vars:
    rpm_artifact_dir: '{{ k3s_python_artifact_dir }}'
    rpm_staging_dir: '{{ k3s_python_rpm_staging_dir }}'
    rpm_package_type: 'Python'

- name: Install python3-kubernetes from system package (online mode)
  when: not (air_gapped | default(false) | bool)
  ansible.builtin.package:
    name: python3-kubernetes
    state: present

- name: Verify python3-kubernetes installation
  ansible.builtin.command: python3 -c "import kubernetes; print(kubernetes.__version__)"
  register: python_kubernetes_version
  changed_when: false
  failed_when: python_kubernetes_version.rc != 0

- name: Display python3-kubernetes version
  ansible.builtin.debug:
    msg: 'python3-kubernetes version: {{ python_kubernetes_version.stdout }}'
