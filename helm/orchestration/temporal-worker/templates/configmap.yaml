apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "temporal-worker.fullname" . }}-config
  labels:
    {{- include "temporal-worker.labels" . | nindent 4 }}
data:
  application.yaml: |
    {{- .Values.config.application | toYaml | nindent 4 }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "temporal-worker.fullname" . }}-spark-defaults
  labels:
    {{- include "temporal-worker.labels" . | nindent 4 }}
data:
  spark-defaults.conf: |
    spark.hadoop.fs.s3a.access.key {{ .Values.spark.hadoop.fs.s3a.accessKey }}
    spark.hadoop.fs.s3a.secret.key {{ .Values.spark.hadoop.fs.s3a.secretKey }}
    spark.hadoop.fs.s3a.endpoint {{ .Values.spark.hadoop.fs.s3a.endpoint }}
    spark.hadoop.fs.s3a.endpoint.region {{ .Values.spark.hadoop.fs.s3a.endpointRegion | default "us-east-1" }}
    spark.databricks.delta.schema.autoMerge.enabled {{ .Values.spark.databricks.delta.schemaAutoMergeEnabled | default "true" }}
    spark.databricks.delta.merge.repartitionBeforeWrite.enabled {{ .Values.spark.databricks.delta.mergeRepartitionBeforeWriteEnabled | default "true" }}
    spark.sql.extensions {{ .Values.spark.sql.extensions | default "io.delta.sql.DeltaSparkSessionExtension" }}
    spark.sql.catalog.spark_catalog {{ .Values.spark.sql.catalog | default "org.apache.spark.sql.delta.catalog.DeltaCatalog" }}
    spark.hadoop.fs.s3a.path.style.access {{ .Values.spark.hadoop.fs.s3a.pathStyleAccess | default "true" }}
    spark.hadoop.fs.s3a.aws.credentials.provider {{ .Values.spark.hadoop.fs.s3a.awsCredentialsProvider | default "org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider" }}
    spark.driver.extraJavaOptions {{ .Values.spark.driver.extraJavaOptions | default "-Divy.cache.dir=/tmp -Divy.home=/tmp" }}